---
title: 'C칩mo probar un paquete npm localmente'
publishedAt: '2020-05-04'
tags:
  - npm
  - link
  - node
  - yalc
banner: 'https://i.imgur.com/XJHiNhx.png'
---

> Este post trata sobre probar un paquete que a칰n no ha sido publicado en un registry de npm.

Hay veces en las que se quiere instalar un paquete local como dependencia del proyecto. Puede que est칠s escribiendo un paquete para distribuci칩n general; o puede que est칠s contribuyendo a un paquete de c칩digo abierto, o un paquete personal privado, o algo interno de tu equipo. Est치s trabajando en cambios locales y necesitas probarlos antes de commitearlos o antes de abrir un pull request o deployar una actualizaci칩n. 쮺u치l es la mejor manera de probar realmente ese paquete a침adi칠ndolo a un proyecto local?

Una de las formas podr칤a ser subir nuestros cambios a Gitub/Gitlab/Bitbucket y agregarlos como dependencia con `npm install` o `yarn add` y junto a `<remote url>[#<ref>]` (o en GitHub por ejemplo `username/repo#branch-name-or-commit-or-tag`). Pero eso requiere de estar pusheando las actualizaciones y de reinstalar el paquete en el proyecto con cada cambio.

Otra opci칩n es agregar el paquete con `npm add relative/path` o `yarn add file:relative/path`, que copian el directorio del paquete en los `node_modules` del proyecto. Lo malo es que no instala dependencias. Tampoco responde a las actualizaciones que realices. Adem치s, el uso de una ruta relativa puede ser dif칤cil de manejar con `../`.

As칤 que aqu칤 te muestro dos maneras de hacerlo que me parecen presentan un enfoque m치s limpio. Mediante:

- [npm link](#npm-link)
- [Yalc](#yalc)

## npm link

Es un proceso de dos pasos:

1. Crea un **symlink** global para una dependencia con `npm link`. Un symlink, abreviatura de enlace simb칩lico, es un acceso directo que apunta a otro directorio o archivo en tu sistema.
2. Hazle saber al proyecto donde probar치s tu paquete que use el enlace simb칩lico global con `npm link my-package`.

### Uso

Entonces en el directorio del paquete en desarrollo `my-package` ejecutaremos

```shell
$ npm link  # paso 1
```

Que lo que hace es, si mis `node_modules` est치n en `/usr/local/lib/node_modules/` entonces crear치 un enlace directo de `/usr/local/lib/node_modules/my-package` a `/Users/lavaldi/repos/my-package`

Luego en el directorio del proyecto donde probar치s el paquete:

```shell
npm link my-package # paso 2
```

Ahora puedes editar, transpilar o ejecutar pruebas en `my-package`. Todo mientras lo pruebas en un proyecto real. Los enlaces simb칩licos son locales y no ser치s commiteados en git. Y cuando est칠s listo para compartir tu c칩digo, puedes publicar los cambios de `my-package` en un registry npm.

### De vuelta a la normalidad

Cuando ya no desees utilizar la versi칩n local de `my-package`, elimina el enlace simb칩lico. Pero cuidado, `npm unlink` es un alias para la desinstalaci칩n de npm (`npm uninstall`), no refleja el comportamiento de `npm link`.

Por eso en el directorio del proyecto donde estabas probando el paquete:

```shell
npm uninstall --no-save my-package && npm install
```

Luego puedes limpiar el enlace global, aunque su presencia no interferir치 con nada. En el directorio del paquete en desarollo:

```shell
npm uninstall  # elimina el symlink
```

Dominar este proceso de dos pasos de `npm link` es una adici칩n 칰til al conjunto de herramientas de cualquier desarrollador de Node.js as칤 que espero esta informaci칩n te sea valiosa.

> Nota: Si usas yarn, lo puedes hacer de la siguiente manera
>
> ```shell
> # para linkear
> yarn link # paso 1
> yarn link my-package # paso 2
> # para volver a la normalidad
> yarn unlink my-package # en el directorio del proyecto donde estabas probando el paquete
> yarn unlink # elimina el symlink global
> ```

Ahora pasemos al siguiente m칠todo 游녢

## Yalc

**yalc** mantiene su propia "registry" local, en `~/.yalc`.

- **Publica** un paquete con yalc, y una copia completa del paquete se copia en el registry.
- **Instala** un paquete del registry de yalc, y el proyecto instalar치 esa copia de la misma manera que instalar칤a un paquete desde un registry externo.
- **Actualiza** un paquete publicado en el registry de yalc, y la actualizaci칩n ya est치 disponible en los proyectos dependientes; incluso puede publicar y actualizar autom치ticamente los proyectos dependientes con un solo comando.

Para evitar que las cosas colisionen, yalc firma cada versi칩n publicada con un hash. Y yalc puede almacenar tantas versiones de un paquete (esa es la versi칩n package.json) como quiera.

### tldr;

_La explicaci칩n de todos los comandos viene [m치s adelante](#instala-yalc)_

En pocas palabras el flujo de trabajo b치sico de yalc es:

```shell
# configuraci칩n
# --------------

$ npm install -g yalc # o yarn global add yalc


# usa yalc
# -----------------------

$ cd path/to/package
my-package $ yalc publish

# si el proyecto donde lo quiero probar
# ya tiene my-package como una dependencia
project $ npm uninstall -S my-package # (or `yarn remove my-package`)

project $ yalc add my-package

# si my-package tiene dependencias
project $ npm install # (or `yarn`)


# desarrollo
# -------

# empieza a hackear ...
# y al terminar

my-package $ yalc push

# si las dependencias de my-package cambiaron, instala las dependencies
project $ npm install # (or `yarn`)

# prueba el proyecto, hackea de nuevo, yalc push, repetir hasta terminar
```

### Instala yalc

```shell
$ npm install -g yalc # o `yarn global add yalc`
```

### Publica un paquete en tu registry local de Yalc

```shell
# en el directorio del paquete en desarrollo
$ yalc publish
```

Este comando lanzar치 al final el nombre real del paquete que usaremos en el siguiente comando.

### A침ade el paquete como una dependencia desde el registry de yalc

```shell
# en el proyecto donde probar치s el paquete
$ yalc add <dependency name>
```

Si miras tu `package.json` ver치s que la dependencia ha sido a침adida, con una ruta parecida a `file:.yalc/`.

```json
"dependencies": {
  "my-package": "file:.yalc/my-package"
}
```

yalc tambi칠n agregar치 el archivo `yalc.lock`, que lista las dependencias del proyecto agregadas con yalc. Despu칠s de que yalc agregue el paquete y el `yalc.lock` en el directorio ra칤z del proyecto dependiente (donde pruebas tu paquete) se ver치 algo como:

```json
{
  "version": "v1",
  "packages": {
    "my-package": {
      "signature": "...", // un hash para identificar la versi칩n del paquete en el registry de yalc
      "file": true // tipo de la conexi칩n de yalc
    }
  }
}
```

yalc no instala las dependencias del paquete, por lo que si el paquete en desarrollo tiene sus propias dependencias en el `package.json`, 칠stas deber치n ser instaladas en el proyecto de prueba como un segundo paso:

```shell
# en el proyecto donde se prueba el paquete
$ npm install # or yarn
```

### Sube los cambios del paquete a los proyectos dependientes locales

Despu칠s de guardar los cambios en el paquete en desarrollo, simplemente ejecuta:

```shell
# en el directorio del paquete en desarrollo
$ yalc push # shorthand para yalc publish --push

Pushing my-package@<version> in path/to/my-package
Pushing my-package@<version>-<hash8> added ==> path/to/my-project/node_modules/package.
Pushing my-package@<version> in path/to/my-project2
Pushing my-package@<version>-<hash8> added ==> path/to/my-project2/node_modules/package.
my-package@<version>-<hash8> published in store.
```

Esto publicar치 una nueva versi칩n en el respository de yalc y actualizar치 autom치ticamente todos los proyectos locales donde yalc a침adi칩 el paquete a la nueva versi칩n.

Si no deseas actualizar autom치ticamente la dependencia en todos los proyectos en los que se ha a침adido (por ejemplo, si tiene varios proyectos con versiones distintas de la dependencia), utiliza:

```shell
# en el directorio del paquete en desarrollo
$ yalc publish
```

```shell
# en el proyecto donde se prueba el paquete
$ yalc update
```

Cuando las dependencias del paquete cambien, reinstala las dependencias del proyecto de dependencia (por ejemplo, `npm i` o `yarn`).

That's it!

---

쯊ienes otros flujos de trabajo favoritos para desarrollar paquetes que ser치n publicados? Me encantar칤a saber, 춰deja un comentario abajo! 游눫游녢
